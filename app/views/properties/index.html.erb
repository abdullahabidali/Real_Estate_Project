<!-- Hero Banner -->
<div class="relative w-full h-64 mb-12 flex items-center justify-center overflow-hidden rounded-b-3xl shadow-lg">
  <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1500&q=80"
       alt="Cityscape" class="absolute inset-0 w-full h-full object-cover opacity-80" />
  <div class="absolute inset-0 bg-gradient-to-r from-blue-400/80 via-purple-400/60 to-blue-200/80"></div>
  <div class="relative z-10 text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold text-white drop-shadow-lg mb-2">Explore Dream Properties</h1>
    <p class="text-lg md:text-2xl text-white drop-shadow">Find your next home, investment, or adventure</p>
  </div>
</div>

<!-- Sell Your Property Section (for sellers) -->
<% if user_signed_in? && current_user.seller? %>
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl shadow-lg p-8 border-2 border-purple-200">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-purple-800 mb-2">Sell Your Property</h2>
          <p class="text-gray-600">List your property and reach potential buyers</p>
        </div>
        <%= link_to new_property_path, class: "bg-gradient-to-r from-purple-500 to-blue-500 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transition flex items-center" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          List New Property
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<!-- Find Your Dream Property Section with Background Image -->
<div class="relative w-full min-h-[400px] flex items-center justify-center mb-16">
  <!-- Background Image -->
  <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1500&q=80"
       alt="Modern Home" class="absolute inset-0 w-full h-full object-cover opacity-80" />
  <!-- Overlay for readability -->
  <div class="absolute inset-0 bg-gradient-to-b from-blue-100/80 via-white/60 to-blue-100/80"></div>

  <!-- Find Your Dream Property Container -->
  <div class="relative z-10 max-w-5xl w-full mx-auto rounded-2xl shadow-2xl border-2 border-purple-200 bg-gradient-to-r from-blue-100 via-white to-purple-100 p-10">
    <h1 class="text-3xl font-extrabold mb-8 text-purple-800 drop-shadow-lg flex items-center">
      <span class="mr-3">Find Your Dream Property</span>
      <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 12l2 2 4-4" />
      </svg>
    </h1>
    <%= form_tag properties_path, method: :get, class: "grid grid-cols-1 md:grid-cols-4 gap-4" do %>
      <div>
        <%= label_tag :property_type, "Property Type", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= select_tag :property_type,
            options_for_select([["All Types", ""], ["House", "house"], ["Apartment", "apartment"],
                              ["Condo", "condo"], ["Townhouse", "townhouse"], ["Land", "land"],
                              ["Commercial", "commercial"]], params[:property_type]),
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline" %>
      </div>
      <div>
        <%= label_tag :city, "City", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= text_field_tag :city, params[:city],
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline",
            placeholder: "Enter city name" %>
      </div>
      <div>
        <%= label_tag :min_price, "Min Price (PKR)", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= number_field_tag :min_price, params[:min_price],
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline",
            placeholder: "Min price in PKR" %>
      </div>
      <div>
        <%= label_tag :max_price, "Max Price (PKR)", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= number_field_tag :max_price, params[:max_price],
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline",
            placeholder: "Max price in PKR" %>
      </div>
      <div>
        <%= label_tag :bedrooms, "Bedrooms", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= number_field_tag :bedrooms, params[:bedrooms],
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline",
            placeholder: "Any" %>
      </div>
      <div>
        <%= label_tag :bathrooms, "Bathrooms", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= number_field_tag :bathrooms, params[:bathrooms],
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline",
            placeholder: "Any" %>
      </div>
      <div>
        <%= label_tag :status, "Status", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= select_tag :status,
            options_for_select([["All", ""], ["Available", "available"], ["Sold", "sold"], ["Pending", "pending"]], params[:status]),
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline" %>
      </div>
      <div>
        <%= label_tag :sort, "Sort By", class: "block text-purple-700 text-sm font-bold mb-2" %>
        <%= select_tag :sort,
            options_for_select([
              ["Default", ""],
              ["Title (A-Z)", "title_asc"],
              ["Title (Z-A)", "title_desc"],
              ["Price (Low to High)", "price_asc"],
              ["Price (High to Low)", "price_desc"]
            ], params[:sort]),
            class: "shadow appearance-none border rounded w-full py-2 px-3 text-purple-800 leading-tight focus:outline-none focus:shadow-outline" %>
      </div>
      <div class="flex items-end space-x-2 mt-6">
        <%= submit_tag "Search", class: "bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" %>
        <%= link_to "Clear Filters", properties_path, class: "ml-2 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Properties Grid -->
<div class="max-w-7xl mx-auto px-4 py-10">
  <% if @properties.any? %>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
      <% @properties.each do |property| %>
        <div class="relative group rounded-3xl shadow-2xl border-4 border-transparent bg-gradient-to-br from-blue-50 via-white to-purple-100 hover:border-purple-400 transition overflow-hidden flex flex-col">
          <!-- Property Image -->
          <% if property.images.attached? %>
            <%= image_tag property.images.first, class: "w-full h-56 object-cover rounded-t-2xl group-hover:scale-105 transition" %>
          <% else %>
            <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=800&q=80"
                 alt="No image" class="w-full h-56 object-cover rounded-t-2xl opacity-80" />
          <% end %>
          <!-- Card Content -->
          <div class="p-6 flex-1 flex flex-col bg-white bg-opacity-90">
            <div class="flex items-center justify-between mb-2">
              <h2 class="text-2xl font-bold text-purple-700"><%= property.title %></h2>
              <% if user_signed_in? %>
                <div class="flex items-center space-x-2">
                <% if current_user.favorite_properties.include?(property) %>
                    <%= button_to favorite_property_path(property), method: :delete, class: "text-pink-500 hover:text-pink-700 transition p-2 rounded-full hover:bg-pink-50" do %>
                      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                      </svg>
                    <% end %>
                <% else %>
                    <%= button_to favorite_property_path(property), method: :post, class: "text-gray-400 hover:text-pink-500 transition p-2 rounded-full hover:bg-pink-50" do %>
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                      </svg>
                    <% end %>
                <% end %>
                </div>
              <% end %>
            </div>
            <p class="text-gray-600 mb-2"><%= property.city %>, <%= property.state %></p>
            <p class="text-xl font-semibold text-blue-700 mb-2"><%= property.formatted_price %></p>
            <div class="flex items-center justify-between mb-4">
              <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-semibold"><%= property.property_type.titleize %></span>
              <span class="text-xs text-gray-500"><%= property.bedrooms %> bd | <%= property.bathrooms %> ba</span>
            </div>
            <div class="mt-auto flex items-center justify-between">
              <%= link_to "View Details", property_path(property), class: "bg-gradient-to-r from-purple-500 to-blue-500 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-2 px-6 rounded-full shadow transition" %>
              <%= link_to "Contact", new_property_message_path(property), class: "ml-2 bg-white border border-blue-500 text-blue-500 px-4 py-2 rounded-lg hover:bg-blue-50 transition" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="flex flex-col items-center justify-center py-24">
      <svg class="w-20 h-20 text-purple-300 mb-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m8.66-13.66l-.71.71M4.05 19.95l-.71.71m16.97 0l-.71-.71M4.05 4.05l-.71-.71M21 12h1M2 12H1m16.24 4.24l.71.71M7.05 7.05l.71.71M12 8a4 4 0 100 8 4 4 0 000-8z" />
      </svg>
      <h2 class="text-2xl font-bold text-purple-700 mb-2">No properties found</h2>
      <p class="text-gray-600 mb-4">Try adjusting your filters or check back later for new listings!</p>
      <%= link_to "Clear Filters", properties_path, class: "bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full shadow transition" %>
    </div>
  <% end %>

  <%# Pagination Controls %>
  <% if @properties.total_pages > 1 %>
    <div class="flex justify-center items-center space-x-2 mt-8 mb-4">
      <% if @properties.prev_page %>
        <%= link_to "← Previous", properties_path(page: @properties.prev_page, property_type: params[:property_type], city: params[:city], min_price: params[:min_price], max_price: params[:max_price], bedrooms: params[:bedrooms], bathrooms: params[:bathrooms], status: params[:status], sort: params[:sort]), class: "px-4 py-2 bg-white border border-purple-500 text-purple-500 rounded-lg hover:bg-purple-50 transition" %>
      <% end %>

      <span class="text-gray-600">
        Page <%= @properties.current_page %> of <%= @properties.total_pages %>
      </span>

      <% if @properties.next_page %>
        <%= link_to "Next →", properties_path(page: @properties.next_page, property_type: params[:property_type], city: params[:city], min_price: params[:min_price], max_price: params[:max_price], bedrooms: params[:bedrooms], bathrooms: params[:bathrooms], status: params[:status], sort: params[:sort]), class: "px-4 py-2 bg-white border border-purple-500 text-purple-500 rounded-lg hover:bg-purple-50 transition" %>
      <% end %>
    </div>
  <% end %>
</div>
